octree_sonar_mapper:
  ros__parameters:
    # Octree parameters
    resolution: 0.05  # Voxel resolution in meters
    dynamic_expansion: true  # Allow map to expand dynamically
    
    # Probability update weights (0.0 to 1.0)
    # These are converted to log-odds internally for Bayesian updates
    # To update LESS for hit and MORE for miss:
    # - prob_hit closer to 0.5 = weaker occupied update (small log-odds)
    # - prob_miss closer to 0.0 = stronger free update (large negative log-odds)
    prob_hit: 0.7  # Weak occupied update when hit detected (slightly > 0.5)
    prob_miss: 0.1   # Strong free update when no hit (much < 0.5)
    
    # Sonar sensor parameters
    max_range: 5.0  # Maximum sonar range in meters
    min_range: 0.5  # Minimum range to filter noise in meters
    fov_degrees: 130.0  # Horizontal field of view in degrees
    fov_margin_degrees: 0.0  # FOV margin to exclude from processing (removes noisy edges)
    vertical_aperture_degrees: 20.0  # Vertical beam aperture in degrees
    intensity_threshold: 35  # Intensity threshold for occupied detection (0-255)
    
    # Sonar-to-boat transformation
    sonar_to_boat_transform:
      # Sonar position relative to boat center (meters)
      position:
        x: 0.0  # Forward/backward offset
        y: 0.0  # Left/right offset  
        z: -0.1  # Up/down offset (10cm below boat)
      # Sonar orientation relative to boat (degrees)
      # To achieve xb=ys, yb=-zs, zb=-xs transformation:
      orientation:
        roll: 0.0    # Rotation around X axis
        pitch: 90.0  # Rotation around Y axis (NOT -90!)
        yaw: -90.0   # Rotation around Z axis
    
    # Visualization parameters
    publish_rate: 1.0  # PointCloud2 publishing rate (Hz)
    min_probability_threshold: 0.7  # Minimum probability to display voxel
    
    # Topic remapping
    sonar_topic: "/oculus/sonar_image_raw"
    odometry_topic: "/Odometry"
    pointcloud_topic: "/sonar_3d_map"
    
    # Frame IDs for TF tree
    sonar_frame_id: "sonar_link"  # Frame for sonar sensor
    body_frame_id: "body"  # Robot body frame (from Fast-LIO)
    map_frame_id: "camera_init"  # Map frame (from Fast-LIO)
    publish_tf: true  # Publish TF transform to connect sonar_link to body
    
    # Use simulation time for bag playback
    use_sim_time: true